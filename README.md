# discord_template_manage

Discord.py と Discord のテンプレート機能を利用し、以下の機能を提供します：
 1. 特定の時間におけるDiscordサーバーの設定を保存します。
 2. サーバー設定は一般的な JSON または TOML 形式で任意の GitHub リポジトリに送信します。
 3. 2.より、サーバー設定の差分を GitHub 由来の機能を使って確認することができます。
 4. JSON または TOML ファイルをコピーし、編集を施すことで、サーバー設定をテキストベースで変更することができます。

なお、このプロジェクトにおいては Discord.py のドキュメント化および公開されていない機能を利用します。

[![Deploy](https://www.herokucdn.com/deploy/button.svg)](https://heroku.com/deploy)

# 詳細
## サーバー設定の形式

出力には JSON 形式と TOML 形式が利用されます。
JSON 形式が利用される理由は、 Discord のテンプレート機能のAPIレスポンスは JSON 形式であるからです。
また、TOML 形式が利用される理由は、読みやすいフォーマットとして認知されているからです。

### JSON 形式

この形式は、Discord API がギルドオブジェクトとして返却する JSON の形式とほとんど同一です。

### TOML 形式

JSON 形式で出力されたものの可読性を高めるために、TOML でも同時に出力します。

##　GitHub リポジトリへの送信

後述しますが、送信先に GitHub リポジトリを指定するために、GitHub の OAuth2 を介してリポジトリへの変更を許可する必要があります。
リポジトリの種類については、パブリックリポジトリでも、プライベートリポジトリでも動作します。

設定を送信したい Discord サーバーで、以下のコマンドを実行してください：

```
template-push https://github.com/(username)/(repository_name)/
```

`template-push` コマンドの引数として、 GitHub リポジトリの URL を渡します。
このコマンドを実行すると、Botが以下のような返信を行います：


> GitHubリポジトリへの変更を行うための認可フローを実行します。
下記のリンクへジャンプしたあと、表示される指示に従ってください。
（リンク）

ここで表示されるリンクをクリックすることで、Botがあなたのリポジトリを変更できるようにする認可作業を始めることができます。
認可が完了するとBotはあなたの送信したURLのリポジトリに、自動でサーバー設定の commit を行います。

## ファイルへの変更

ファイルを介してサーバー設定を変更する場合、あなたはファイル編集に関して以下の手順を踏む必要があります：

 1. GitHub リポジトリを clone する（任意）。
 2. ファイルを編集して、 commit する。

commit が終わったら、サーバー上で以下のコマンドを送信してください：

```
template-pull https://github.com/(username)/(repository_name)/
```

`template-pull` コマンドの引数として、 GitHub リポジトリの URL を渡します。
Bot はリポジトリの URL を自動的に参照して、最新の commit からサーバー設定を構築します。

なお、「設定用ファイルに不正な構文が含まれていた」「Bot の権限が不足していた」などの理由でサーバー設定を構築できない場合、Botからエラーメッセージが送信されます。
解決できない場合はサポートサーバーにエラーメッセージをご連絡ください。

# 免責事項

このプロジェクトは coolwind0202 が個人的に行っているものです。
最大限の注意を払って開発していますが、万が一サーバー設定が故障したなど不利益が生じた場合の責任は取らないつもりなので、自己責任でお願いします。

連絡は [サポートサーバー](https://discord.com) までお願いします。ただし、すべての連絡に応答するとは限りません。